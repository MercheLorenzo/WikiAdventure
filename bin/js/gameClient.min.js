var lobbyID="${lobbyID}",playerID="${playerID}",lobbyLang="${lobbyLang}",hasVoted=!1,socket,pageStart,pageEnd,stateCounter;function showAlert(title,data){var div=document.createElement("div");div.className="alert",div.innerHTML="<h3>"+title+"</h3><p>"+data+"</p>",div.onclick=function(e){div.style.opacity=0,setTimeout((function(){div.remove()}),500)},document.body.appendChild(div),setTimeout((function(){div.style.opacity=0}),15e3),setTimeout((function(){div.remove()}),15500)}function switchState(data){var hasVoted=!1;clearInterval(stateCounter),document.getElementById("inputVote").placeholder="${votePlaceholder}";var idx=data.indexOf("|"),state=data.substring(0,idx),remain=data.substring(idx+1);idx=remain.indexOf("|");var round=remain.substring(0,idx),time=remain.substring(idx+1);showAlert(state+" round "+round,"Check your board for more info<br/>You can click to close me"),document.getElementById("stateName").innerText=state+" round "+round;var timeLeft=time,timeStamp=Date.now(),countdownSound=document.getElementById("countdownSound"),playing=!1;stateCounter=setInterval((function(){var time=Date.now(),dt=time-timeStamp;timeStamp=time,(timeLeft-=.001*dt)<=10&&(playing||(countdownSound.play(),playing=!0)),document.getElementById("stateTime").innerText=Math.ceil(timeLeft),timeLeft<0&&(clearInterval(stateCounter),document.getElementById("stateTime").innerText=0,playing=!1)}),100)}function addMessage(message){var messageLine=document.createElement("li");messageLine.textContent=message,document.getElementById("outputMessages").insertBefore(messageLine,document.getElementById("outputMessages").childNodes[0])}function disableLinks(){for(var links=document.getElementsByTagName("a"),i=0;i<links.length;i++)links[i].addEventListener("click",(function(e){if(-1==this.getAttribute("href").lastIndexOf(":")&&-1==this.getAttribute("href").lastIndexOf(".ogg")&&"mw:ExtLink"!=this.rel&&!this.classList.contains("new")){var idx=this.href.lastIndexOf("/");decodeURIComponent();var url=this.href.substring(idx+1),anchor=url.indexOf("#");-1!=anchor&&(url=url.substring(0,anchor)),requestWikiPage(url=decodeURIComponent(url))}e.preventDefault()}))}function requestWikiPage(url){socket.emit("validateJump",url),decodeURI(url)==pageEnd&&document.getElementById("winSound").play();var header=new Headers({"Api-User-Agent":"pediaFinder/1.1 (https://pedia-finder.herokuapp.com/; benjamin.gilloury@gmail.com)",origin:"*"}),options;fetch("https://${lobbyLang}.wikipedia.org/api/rest_v1/page/html/"+url,{method:"GET",headers:header,mode:"cors",cache:"default"}).then((function(response){return response.text()})).then((function(response){var trueTitle,parser=new DOMParser;console.log(response);var wikiData=parser.parseFromString(response,"text/html"),cssLinks=wikiData.head.getElementsByTagName("link");document.getElementById("wikiSection").innerHTML="";for(var i=0;i<document.head.childNodes.length;i++)"link"==document.head.childNodes[i].tagName&&"uiCSS"!=document.head.childNodes[i].id&&document.head.childNodes[i].remove();for(var i=0;i<cssLinks.length;i++)"stylesheet"==cssLinks[i].rel&&(cssLinks[i].href+="https://${lobbyLang}.wikipedia.org",document.head.appendChild(cssLinks[i]));document.getElementById("wikiSection").innerHTML=wikiData.body.innerHTML,disableLinks(),document.body.scrollTop=0,document.documentElement.scrollTop=0,history.pushState?window.history.pushState("lobby ${lobbyID}","WikiAdventure",lobbyID+"?"+url):document.location.href=lobbyID+"?"+url}))}addEventListener("load",(function(){function voteSubmit(vote){var requestTitle=vote;socket.emit("vote",requestTitle),document.getElementById("playerVote").innerText=requestTitle,document.getElementById("inputVote").value="",document.getElementById("inputVote").placeholder="${votePlaceholderSubmitted}",fetch("https://${lobbyLang}.wikipedia.org/w/api.php?action=query&origin=*&list=search&srlimit=1&srnamespace=0&srsearch=intitle:"+encodeURIComponent(requestTitle)+"&format=json&srprop=").then((function(response){return response.json()})).then((function(response){var trueTitle;trueTitle=void 0===response.query.search[0]?"no page found":response.query.search[0].title,document.getElementById("playerVote").innerText=requestTitle+" â†’ "+trueTitle}))}(socket=io("/"+lobbyID,{query:"playerID="+playerID})).on("error",error=>{var logMessage="${socketError}";console.log(error),console.log(logMessage),addMessage(error),addMessage(logMessage)}),document.getElementById("chatForm").onsubmit=function(e){e.preventDefault(),socket.emit("message",document.getElementById("inputMessage").value),document.getElementById("inputMessage").value="";var hasVoted=!0;return!1},document.getElementById("votingForm").onsubmit=function(e){e.preventDefault(),voteSubmit(document.getElementById("inputVote").value)},socket.on("message",(function(msg){addMessage(msg)})),socket.on("voteResult",(function(data){var idx=data.indexOf("?");pageStart=data.substring(0,idx),document.getElementById("pageStart").innerText=pageStart,pageEnd=data.substring(idx+1),document.getElementById("pageEnd").innerText=pageEnd,requestWikiPage(pageStart)})),socket.on("playerLeft",(function(playerID){document.getElementById("player"+playerID).remove()})),socket.on("updateScore",(function(data){var idx=data.indexOf(":"),playerID=data.substring(0,idx),score=data.substring(idx+1);document.getElementById("player"+playerID).getElementsByClassName("playerScore")[0].innerText=score})),socket.on("newPlayer",(function(data){var idx=data.indexOf(":"),playerID=data.substring(0,idx),remain=data.substring(idx+1);idx=remain.indexOf(":");var playerName=remain.substring(0,idx),playerScore=remain.substring(idx+1);if(null==document.getElementById("player"+playerID)){var div=document.createElement("div");div.className="score",div.innerHTML='<p class="playerName">'+playerName+'</p><p class="playerScore">'+playerScore+"</p>",div.id="player"+playerID,document.getElementById("playerScoreSection").appendChild(div)}})),socket.on("gameState",(function(data){switchState(data)}))})),addEventListener("beforeunload",(function(event){var confirmationMessage="${exitWarning}";return event.returnValue="${exitWarning}","${exitWarning}"})),addEventListener("unload",(function(event){socket.close()})),addEventListener("keydown",event=>{event.isComposing||229===event.keyCode||27===event.keyCode&&(document.getElementById("showUI").checked=!document.getElementById("showUI").checked)});